<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nirobo ‚Äî Analytics Dashboard</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #004d00, #006400);
      color: #f5f5f5;
      margin: 0;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      padding: 30px 0;
      border-bottom: 2px solid #d40000;
      margin-bottom: 30px;
    }

    header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
      margin-bottom: 40px;
    }

    .stat-card {
      background: rgba(0, 0, 0, 0.3);
      padding: 25px;
      border-radius: 15px;
      border: 1px solid rgba(212, 0, 0, 0.3);
    }

    .stat-card h2 {
      color: #ffcccc;
      margin-bottom: 20px;
      font-size: 1.4rem;
      border-bottom: 1px solid #d40000;
      padding-bottom: 10px;
    }

    .stat-number {
      font-size: 2.5rem;
      font-weight: bold;
      color: #ff9999;
      margin: 15px 0;
    }

    .chart {
      height: 200px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      padding: 15px;
      margin-top: 20px;
    }

    .chart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      font-size: 0.95rem;
    }

    .chart-bar {
      height: 12px;
      background: #d40000;
      border-radius: 3px;
      margin-left: 10px;
      flex-grow: 1;
    }

    .popular-searches, .popular-urls {
      background: rgba(0, 0, 0, 0.3);
      padding: 25px;
      border-radius: 15px;
      margin-bottom: 40px;
      border: 1px solid rgba(212, 0, 0, 0.3);
    }

    .popular-searches h2, .popular-urls h2 {
      color: #ffcccc;
      margin-bottom: 20px;
      font-size: 1.4rem;
      border-bottom: 1px solid #d40000;
      padding-bottom: 10px;
    }

    .search-item, .url-item {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .search-term, .url-title {
      font-weight: bold;
    }

    .search-count, .url-views {
      color: #ff9999;
      font-weight: bold;
    }

    footer {
      background-color: #1a1a1a;
      color: #ccc;
      padding: 20px;
      text-align: center;
      font-size: 0.9rem;
      border-top: 1px solid #333;
      margin-top: 40px;
    }

    footer a {
      color: #ff9999;
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üìä NIROBO ANALYTICS DASHBOARD</h1>
      <p>‚ÄúData is the silent voice of your audience ‚Äî listen carefully.‚Äù</p>
    </header>

    <!-- Summary Stats -->
    <div class="stats-grid">
      <div class="stat-card">
        <h2>üìà Total Pageviews</h2>
        <div class="stat-number" id="totalPageviews">0</div>
        <p>Across all pages</p>
      </div>

      <div class="stat-card">
        <h2>üë• Unique Visitors</h2>
        <div class="stat-number" id="uniqueVisitors">0</div>
        <p>Individual users</p>
      </div>

      <div class="stat-card">
        <h2>üåç Top Country</h2>
        <div class="stat-number" id="topCountry">-</div>
        <p>Most visits from</p>
      </div>

      <div class="stat-card">
        <h2>üì± Top Browser</h2>
        <div class="stat-number" id="topBrowser">-</div>
        <p>Most used browser</p>
      </div>
    </div>

    <!-- Charts -->
    <div class="stats-grid">
      <div class="stat-card">
        <h2>üåê Countries</h2>
        <div class="chart" id="countryChart"></div>
      </div>

      <div class="stat-card">
        <h2>üíª Browsers</h2>
        <div class="chart" id="browserChart"></div>
      </div>

      <div class="stat-card">
        <h2>üì≤ Devices</h2>
        <div class="chart" id="deviceChart"></div>
      </div>

      <div class="stat-card">
        <h2>üîó Referrers</h2>
        <div class="chart" id="referrerChart"></div>
      </div>
    </div>

    <!-- Popular Searches -->
    <div class="popular-searches">
      <h2>üî• Popular Search Terms</h2>
      <div id="popularSearchesList">
        <p>No search data yet.</p>
      </div>
    </div>

    <!-- Popular URLs -->
    <div class="popular-urls">
      <h2>üöÄ Popular Submitted URLs</h2>
      <div id="popularUrlsList">
        <p>No URL view data yet.</p>
      </div>
    </div>

    <footer>
      Made in Bangladesh üáßüá© | Curated by Nirobo<br>
      Honoring the Language Movement and the Silent Legacy of Justice<br>
      Crafted by KH. AL SHAIF ‚Äî for truth, clarity, and cultural dignity<br>
      <a href="index.html">‚Üê Back to Nirobo</a>
    </footer>
  </div>

  <script>
    // Load analytics data
    function loadAnalytics() {
      const visits = JSON.parse(localStorage.getItem('niroboVisits') || '[]');
      const allSubmissions = JSON.parse(localStorage.getItem('niroboAllSubmissions') || '[]');

      // Summary Stats
      document.getElementById('totalPageviews').textContent = visits.length;
      
      const uniqueVisitors = new Set(visits.map(v => v.visitorId)).size;
      document.getElementById('uniqueVisitors').textContent = uniqueVisitors;

      // Top Country
      const countryStats = {};
      visits.forEach(v => {
        countryStats[v.country] = (countryStats[v.country] || 0) + 1;
      });
      const topCountry = Object.entries(countryStats).sort((a,b) => b[1] - a[1])[0];
      if (topCountry) {
        document.getElementById('topCountry').textContent = `${topCountry[0]} (${topCountry[1]})`;
      }

      // Top Browser
      const browserStats = {};
      visits.forEach(v => {
        browserStats[v.browser] = (browserStats[v.browser] || 0) + 1;
      });
      const topBrowser = Object.entries(browserStats).sort((a,b) => b[1] - a[1])[0];
      if (topBrowser) {
        document.getElementById('topBrowser').textContent = `${topBrowser[0]} (${topBrowser[1]})`;
      }

      // Render Charts
      renderChart('countryChart', countryStats, 10);
      renderChart('browserChart', browserStats, 5);
      
      // Device Stats
      const deviceStats = {};
      visits.forEach(v => {
        deviceStats[v.device] = (deviceStats[v.device] || 0) + 1;
      });
      renderChart('deviceChart', deviceStats, 3);

      // Referrer Stats
      const referrerStats = {};
      visits.forEach(v => {
        const ref = v.referrer === '' ? 'Direct' : new URL(v.referrer).hostname;
        referrerStats[ref] = (referrerStats[ref] || 0) + 1;
      });
      renderChart('referrerChart', referrerStats, 5);

      // Popular Searches
      const searchParams = new URLSearchParams(window.location.search);
      const searchTerms = {};
      visits.forEach(v => {
        if (v.url.includes('search.html?q=')) {
          const url = new URL(v.url);
          const q = url.searchParams.get('q');
          if (q) {
            searchTerms[q] = (searchTerms[q] || 0) + 1;
          }
        }
      });

      const popularSearchesList = document.getElementById('popularSearchesList');
      if (Object.keys(searchTerms).length === 0) {
        popularSearchesList.innerHTML = '<p>No search data yet.</p>';
      } else {
        popularSearchesList.innerHTML = '';
        Object.entries(searchTerms)
          .sort((a,b) => b[1] - a[1])
          .slice(0, 10)
          .forEach(([term, count]) => {
            const div = document.createElement('div');
            div.className = 'search-item';
            div.innerHTML = `
              <span class="search-term">${term}</span>
              <span class="search-count">${count} views</span>
            `;
            popularSearchesList.appendChild(div);
          });
      }

      // Popular URLs
      const popularUrlsList = document.getElementById('popularUrlsList');
      if (allSubmissions.length === 0) {
        popularUrlsList.innerHTML = '<p>No URL view data yet.</p>';
      } else {
        // Sort by viewCount
        const sortedUrls = allSubmissions
          .filter(sub => sub.viewCount > 0)
          .sort((a,b) => (b.viewCount || 0) - (a.viewCount || 0))
          .slice(0, 10);

        if (sortedUrls.length === 0) {
          popularUrlsList.innerHTML = '<p>No URL views recorded yet.</p>';
        } else {
          popularUrlsList.innerHTML = '';
          sortedUrls.forEach(sub => {
            const div = document.createElement('div');
            div.className = 'url-item';
            div.innerHTML = `
              <span class="url-title">${sub.title}</span>
              <span class="url-views">${sub.viewCount} views</span>
            `;
            popularUrlsList.appendChild(div);
          });
        }
      }
    }

    // Render Chart
    function renderChart(containerId, data, maxItems) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';

      if (Object.keys(data).length === 0) {
        container.innerHTML = '<p>No data available</p>';
        return;
      }

      const sorted = Object.entries(data).sort((a,b) => b[1] - a[1]).slice(0, maxItems);
      const maxCount = sorted[0][1];

      sorted.forEach(([label, count]) => {
        const item = document.createElement('div');
        item.className = 'chart-item';
        const percentage = (count / maxCount) * 100;
        item.innerHTML = `
          <span>${label}</span>
          <div style="display: flex; align-items: center; width: 100%;">
            <span style="width: 60px; text-align: right; margin-right: 10px;">${count}</span>
            <div class="chart-bar" style="width: ${percentage}%;"></div>
          </div>
        `;
        container.appendChild(item);
      });
    }

    // Initialize
    loadAnalytics();
  </script>
</body>
</html>
