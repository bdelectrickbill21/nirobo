<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard - Nirobo Search</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-dark: #004d00;
      --primary: #006400;
      --primary-light: #008000;
      --accent: #d40000;
      --accent-hover: #ff0000;
      --background: #0a1f0a;
      --card-bg: #1a1a1a;
      --text: #f5f5f5;
      --text-secondary: #cccccc;
      --border: #333333;
      --success: #00aa00;
      --warning: #ff9900;
      --danger: #d40000;
      --info: #0066cc;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    }
    body {
      background: linear-gradient(135deg, var(--background), #003300);
      color: var(--text);
      line-height: 1.6;
      padding: 20px;
      min-height: 100vh;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      position: relative;
    }
    /* Header Styles */
    header {
      text-align: center;
      padding: 30px 0;
      margin-bottom: 30px;
      position: relative;
    }
    .logo {
      font-size: 2.8rem;
      color: var(--accent);
      margin-bottom: 10px;
      text-shadow: 0 0 15px rgba(212, 0, 0, 0.5);
    }
    .tagline {
      font-size: 1.2rem;
      color: #ffcccc;
      font-style: italic;
      margin-bottom: 20px;
    }
    /* User Info & Logout */
    .user-info {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 10px;
      display: inline-block;
      margin-bottom: 30px;
      color: #ffcccc;
    }
    .logout-btn {
      background: var(--danger);
      padding: 10px 20px;
      font-size: 1rem;
      display: inline-block;
      margin-left: 15px;
      text-align: center;
      width: auto;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      color: white;
      font-weight: bold;
    }
    .logout-btn:hover {
      background: #ff3333;
    }
    /* Dashboard Sections */
    .dashboard-section {
      background: rgba(26, 26, 26, 0.8);
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(212, 0, 0, 0.3);
    }
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      flex-wrap: wrap;
      gap: 15px;
    }
    .section-title {
      font-size: 1.8rem;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    /* Analytics Section */
    .analytics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .metric-card {
      background: rgba(0, 100, 0, 0.2);
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }
    .metric-value {
      font-size: 2rem;
      font-weight: bold;
      margin: 10px 0;
    }
    .metric-label {
      font-size: 0.9rem;
      color: var(--text-secondary);
      margin-bottom: 10px;
    }
    /* Submissions Section - Library Shelf Style */
    .submissions-library {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 25px;
      margin-top: 20px;
    }
    .shelf {
      background: rgba(0, 100, 0, 0.1);
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 30px;
      border: 1px solid rgba(212, 0, 0, 0.2);
    }
    .shelf-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(212, 0, 0, 0.2);
    }
    .shelf-title {
      font-size: 1.4rem;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .shelf-count {
      font-size: 0.9rem;
      color: var(--text-secondary);
    }
    .shelf-books {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }
    .book-card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    .book-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(212, 0, 0, 0.3);
      border-color: var(--accent-hover);
    }
    .book-cover {
      width: 100%;
      height: 120px;
      background: rgba(212, 0, 0, 0.2);
      border-radius: 4px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      color: var(--accent);
    }
    .book-title {
      font-size: 1.1rem;
      margin-bottom: 8px;
      color: #ff9999;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .book-url {
      color: #888;
      font-size: 0.85rem;
      margin-bottom: 12px;
      display: block;
      word-break: break-all;
    }
    .book-status {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: bold;
      margin-bottom: 15px;
    }
    .book-status.approved {
      background: rgba(0, 170, 0, 0.3);
      color: var(--success);
    }
    .book-status.rejected {
      background: rgba(212, 0, 0, 0.3);
      color: var(--danger);
    }
    .book-status.pending {
      background: rgba(255, 153, 0, 0.3);
      color: var(--warning);
    }
    .book-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
      color: var(--text-secondary);
      padding-top: 15px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    .book-actions {
      display: flex;
      gap: 8px;
      justify-content: center;
      margin-top: 15px;
    }
    .book-action-btn {
      background: rgba(255, 255, 255, 0.1);
      color: var(--text);
      border: 1px solid var(--border);
      padding: 6px 12px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.8rem;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .book-action-btn:hover {
      background: var(--accent);
      border-color: var(--accent);
    }
    /* Account Section */
    .account-form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      color: var(--text-secondary);
      font-weight: 500;
    }
    input, textarea, select {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: rgba(0, 0, 0, 0.3);
      color: var(--text);
      font-size: 16px;
      box-sizing: border-box;
    }
    button.main-btn {
      padding: 12px 24px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      width: 100%;
      margin-top: 10px;
    }
    button.main-btn:hover {
      background: var(--accent-hover);
      box-shadow: 0 0 20px rgba(255, 0, 0, 0.7);
      transform: translateY(-2px);
    }
    /* Policy Button */
    .policy-section {
      text-align: center;
      margin: 20px 0;
    }
    .policy-button {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 12px 24px;
      background: rgba(0, 100, 0, 0.3);
      color: white;
      text-decoration: none;
      border-radius: 30px;
      font-weight: bold;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0, 100, 0, 0.3);
    }
    .policy-button:hover {
      background: rgba(0, 128, 0, 0.5);
      box-shadow: 0 8px 20px rgba(0, 128, 0, 0.5);
      transform: translateY(-3px);
    }
    /* Submit URL Button at Bottom */
    .submit-section {
      text-align: center;
      margin: 40px 0 20px;
    }
    .submit-button {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 12px 24px;
      background: var(--primary);
      color: white;
      text-decoration: none;
      border-radius: 30px;
      font-weight: bold;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0, 100, 0, 0.3);
    }
    .submit-button:hover {
      background: var(--primary-light);
      box-shadow: 0 8px 20px rgba(0, 128, 0, 0.5);
      transform: translateY(-3px);
    }
    /* Footer */
    footer {
      background: rgba(26, 26, 26, 0.9);
      color: #ccc;
      padding: 30px;
      text-align: center;
      font-size: 0.9rem;
      border-top: 1px solid var(--border);
      margin-top: 50px;
      border-radius: 10px;
    }
    footer a {
      color: #ff9999;
      text-decoration: none;
    }
    footer a:hover {
      text-decoration: underline;
    }
    /* Loading State */
    .loading {
      text-align: center;
      padding: 40px;
    }
    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      border-top: 4px solid var(--accent);
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    /* No Results with Animation */
    .no-results {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
    }
    .no-results i {
      font-size: 3rem;
      margin-bottom: 20px;
      color: #555;
      animation: shake 0.5s ease-in-out;
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    .no-results.animated {
       animation: fadeIn 1s ease-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 50px 20px;
      color: var(--text-secondary);
    }
    /* Notification */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 500;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      z-index: 1000;
      transform: translateX(120%);
      transition: transform 0.3s ease;
      max-width: 300px;
    }
    .notification.show {
      transform: translateX(0);
    }
    .notification.success {
      background: linear-gradient(45deg, var(--success), #00cc00);
    }
    .notification.error {
      background: linear-gradient(45deg, var(--danger), #ff3333);
    }
    .notification.warning {
      background: linear-gradient(45deg, var(--warning), #ffcc00);
    }
    .notification.info {
      background: linear-gradient(45deg, var(--info), #0088ff);
    }
    /* Bangladesh Indicator */
    body::after {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        radial-gradient(circle at 20% 30%, rgba(212, 0, 0, 0.03) 0%, transparent 15%),
        radial-gradient(circle at 80% 70%, rgba(0, 100, 0, 0.03) 0%, transparent 20%);
      pointer-events: none;
      z-index: -1;
    }
    /* Responsive Design */
    @media (max-width: 768px) {
      body {
        padding: 15px;
      }
      .dashboard-section {
        padding: 20px;
      }
      #search-form {
        flex-direction: column;
      }
      .search-header {
        flex-direction: column;
        text-align: center;
      }
      .result-header {
        flex-direction: column;
      }
      .result-meta {
        flex-direction: column;
        align-items: flex-start;
      }
      .result-actions {
        width: 100%;
        justify-content: flex-end;
      }
      /* Adjust tools popup for mobile */
      #toolsPopup {
        width: 95%;
        padding: 20px;
      }
      .calculator-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: 5px;
      }
      .calc-btn {
        padding: 12px;
        font-size: 1rem;
      }
      .converter-form {
        flex-direction: column;
      }
      .converter-form input,
      .converter-form select,
      .converter-form button {
        width: 100%;
      }
      .account-form {
        grid-template-columns: 1fr;
      }
      .policy-section {
        margin: 20px 0;
      }
      .policy-button {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        padding: 12px 24px;
        background: rgba(0, 100, 0, 0.3);
        color: white;
        text-decoration: none;
        border-radius: 30px;
        font-weight: bold;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(0, 100, 0, 0.3);
      }
      .policy-button:hover {
        background: rgba(0, 128, 0, 0.5);
        box-shadow: 0 8px 20px rgba(0, 128, 0, 0.5);
        transform: translateY(-3px);
      }
      /* Submit URL Button at Bottom */
      .submit-section {
        text-align: center;
        margin: 40px 0 20px;
      }
      .submit-button {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        padding: 12px 24px;
        background: var(--primary);
        color: white;
        text-decoration: none;
        border-radius: 30px;
        font-weight: bold;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(0, 100, 0, 0.3);
      }
      .submit-button:hover {
        background: var(--primary-light);
        box-shadow: 0 8px 20px rgba(0, 128, 0, 0.5);
        transform: translateY(-3px);
      }
      /* Footer */
      footer {
        background: rgba(26, 26, 26, 0.9);
        color: #ccc;
        padding: 30px;
        text-align: center;
        font-size: 0.9rem;
        border-top: 1px solid var(--border);
        margin-top: 50px;
        border-radius: 10px;
      }
      footer a {
        color: #ff9999;
        text-decoration: none;
      }
      footer a:hover {
        text-decoration: underline;
      }
      /* Empty State */
      .empty-state {
        text-align: center;
        padding: 50px 20px;
        color: var(--text-secondary);
      }
      /* Notification */
      .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 8px;
        color: white;
        font-weight: 500;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        z-index: 1000;
        transform: translateX(120%);
        transition: transform 0.3s ease;
        max-width: 300px;
      }
      .notification.show {
        transform: translateX(0);
      }
      .notification.success {
        background: linear-gradient(45deg, var(--success), #00cc00);
      }
      .notification.error {
        background: linear-gradient(45deg, var(--danger), #ff3333);
      }
      .notification.warning {
        background: linear-gradient(45deg, var(--warning), #ffcc00);
      }
      .notification.info {
        background: linear-gradient(45deg, var(--info), #0088ff);
      }
      /* Bangladesh Indicator */
      body::after {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: 
          radial-gradient(circle at 20% 30%, rgba(212, 0, 0, 0.03) 0%, transparent 15%),
          radial-gradient(circle at 80% 70%, rgba(0, 100, 0, 0.03) 0%, transparent 20%);
        pointer-events: none;
        z-index: -1;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <i class="fas fa-brain"></i> NIROBO
      </div>
      <div class="tagline">"Intelligent URL Discovery Powered by AI"</div>
      <a href="/" style="color: #ff9999; text-decoration: none;">← Back to Nirobo</a>
    </header>

    <!-- User Info & Logout -->
    <div class="user-info">
      Logged in as: <strong id="userEmail">loading...</strong>
      <button id="logoutBtn" class="logout-btn">🚪 Logout</button>
    </div>

    <!-- Analytics Section -->
    <section class="dashboard-section">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-chart-line"></i> Your Analytics
        </h2>
      </div>
      <div class="analytics-grid">
        <div class="metric-card">
          <div class="metric-value" id="totalClicks">0</div>
          <div class="metric-label">Total Clicks Received</div>
        </div>
        <div class="metric-card">
          <div class="metric-value" id="uniqueCountries">0</div>
          <div class="metric-label">Unique Countries</div>
        </div>
        <div class="metric-card">
          <div class="metric-value" id="totalSubmissions">0</div>
          <div class="metric-label">Your Submissions</div>
        </div>
        <div class="metric-card">
          <div class="metric-value" id="approvedCount">0</div>
          <div class="metric-label">Approved</div>
        </div>
      </div>
    </section>

    <!-- URL Submissions Section - Library Shelf Style -->
    <section class="dashboard-section">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-book"></i> Your URL Library
        </h2>
      </div>
      <div class="submissions-library" id="submissionsLibrary">
        <p>Loading your submissions...</p>
      </div>
    </section>

    <!-- Account Management Section -->
    <section class="dashboard-section">
      <div class="section-header">
        <h2 class="section-title">
          <i class="fas fa-user-cog"></i> Account Management
        </h2>
      </div>
      <div class="account-form">
        <!-- Change Email -->
        <div class="form-group">
          <label for="newEmail">Change Email Address</label>
          <input type="email" id="newEmail" placeholder="Enter new email">
          <button class="main-btn" id="changeEmailBtn">Update Email</button>
        </div>
        
        <!-- Change Password -->
        <div class="form-group">
          <label for="oldPassword">Old Password</label>
          <input type="password" id="oldPassword" placeholder="Enter current password">
          <label for="newPassword">New Password</label>
          <input type="password" id="newPassword" placeholder="Enter new password">
          <label for="confirmNewPassword">Confirm New Password</label>
          <input type="password" id="confirmNewPassword" placeholder="Re-enter new password">
          <button class="main-btn" id="changePasswordBtn">Update Password</button>
        </div>
        
        <!-- Delete Account -->
        <div class="form-group">
          <label>Delete Your Account</label>
          <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 15px;">
            This action is irreversible. All your data will be permanently deleted.
          </p>
          <button class="main-btn" id="deleteAccountBtn" style="background: var(--danger);">Delete Account</button>
        </div>
      </div>
    </section>

    <!-- Policy & Terms Button -->
    <div class="policy-section">
      <a href="policy.html" class="policy-button">
        <i class="fas fa-file-contract"></i> View Policy & Terms
      </a>
    </div>

    <!-- Submit URL Button at the Bottom -->
    <div class="submit-section">
      <a href="signup.html" class="submit-button">
        <i class="fas fa-plus-circle"></i> Submit Your URL
      </a>
    </div>

    <footer>
      <p>Made in Bangladesh 🇧🇩 | Curated by Nirobo</p>
      <p>Honoring the Language Movement and the Silent Legacy of Justice</p>
      <p>Crafted by KH. AL SHAIF — for truth, clarity, and cultural dignity</p>
      <p><a href="/">← Back to Nirobo</a></p>
    </footer>
  </div>

  <div class="notification" id="notification"></div>

  <script>
    // --- CONFIGURATION ---
    const RESULTS_PER_PAGE = 10;
    const MAX_SUBMISSIONS_PER_USER = 1971; // Enforce the 1971 URL limit
    let currentPage = 1;
    let currentFilter = 'all';
    let allResults = [];
    let filteredResults = [];
    let query = '';
    let searchHistory = [];
    // Variable to hold the Fuse.js instance
    let fuseInstance = null;
    // --- DOM Elements ---
    const userEmail = document.getElementById('userEmail');
    const logoutBtn = document.getElementById('logoutBtn');
    const submissionsLibrary = document.getElementById('submissionsLibrary');
    const notification = document.getElementById('notification');
    const newEmail = document.getElementById('newEmail');
    const oldPassword = document.getElementById('oldPassword');
    const newPassword = document.getElementById('newPassword');
    const confirmNewPassword = document.getElementById('confirmNewPassword');
    const changeEmailBtn = document.getElementById('changeEmailBtn');
    const changePasswordBtn = document.getElementById('changePasswordBtn');
    const deleteAccountBtn = document.getElementById('deleteAccountBtn');
    // --- Helper Functions ---
    // Show notification
    function showNotification(message, type = 'info') {
      notification.textContent = message;
      notification.className = 'notification ' + type;
      notification.classList.add('show');
      setTimeout(() => notification.classList.remove('show'), 3000);
    }
    // Load data from localStorage
    function loadData(key, defaultValue = []) {
      try {
        return JSON.parse(localStorage.getItem(key) || JSON.stringify(defaultValue));
      } catch (e) {
        console.error(`Error loading ${key}:`, e);
        return defaultValue;
      }
    }
    // Save data to localStorage
    function saveData(key, data) {
      try {
        localStorage.setItem(key, JSON.stringify(data));
      } catch (e) {
        console.error(`Error saving ${key}:`, e);
        showNotification('Failed to save data. Storage might be full.', 'error');
      }
    }
    // Hash password (simple for demo - NOT secure for production)
    function hashPassword(pw) {
      return btoa(pw); // Base64 encoding (NOT secure)
    }
    // Format date
    function formatDate(isoString) {
      if (!isoString) return 'Unknown';
      const date = new Date(isoString);
      return date.toLocaleString('en-GB', {
        timeZone: 'Asia/Dhaka',
        day: '2-digit',
        month: 'short',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        hour12: true
      });
    }
    // Get domain
    function getDomain(url) {
      try {
        return new URL(url).hostname.replace('www.', '');
      } catch {
        return 'unknown';
      }
    }
    // Check if user is banned
    function isUserBanned(userId) {
      const punishments = loadData('niroboPunishments', {});
      const userPunishment = punishments[userId];
      if (!userPunishment) return false;
      if (userPunishment.banStatus === "perm_ban") {
        return true;
      }
      if (userPunishment.banStatus === "temp_ban" && userPunishment.banUntil) {
        const banUntil = new Date(userPunishment.banUntil);
        if (new Date() < banUntil) {
          return true;
        } else {
          // Ban expired - remove it
          delete punishments[userId];
          saveData('niroboPunishments', punishments);
          return false;
        }
      }
      return false;
    }
    // --- AUTHENTICATION ---
    // Check if user is logged in
    function checkAuth() {
      const currentUser = loadData('niroboCurrentUser', null);
      if (!currentUser) {
        // Not logged in, redirect to login
        window.location.href = 'login.html';
        return null;
      }
      // Check ban status
      if (isUserBanned(currentUser.id)) {
        showNotification('❌ Your account has been banned. Please contact support.', 'error');
        localStorage.removeItem('niroboCurrentUser');
        setTimeout(() => {
           window.location.href = 'signup.html';
        }, 2000);
        return null;
      }
      // User is logged in and not banned
      userEmail.textContent = currentUser.email;
      return currentUser;
    }
    // Logout button handler
    logoutBtn.addEventListener('click', () => {
      localStorage.removeItem('niroboCurrentUser');
      showNotification('✅ Logged out successfully.', 'success');
      // Redirect to login page
      setTimeout(() => {
        window.location.href = 'login.html';
      }, 1000);
    });
    // --- ANALYTICS ---
    function displayAnalytics() {
      const currentUser = checkAuth();
      if (!currentUser) return;
      const allSubmissions = loadData('niroboAllSubmissions', []);
      const userSubmissions = allSubmissions.filter(sub => sub.userId === currentUser.id);
      
      // Simulate analytics data
      let totalClicks = 0;
      let uniqueCountries = new Set();
      userSubmissions.forEach(sub => {
        totalClicks += sub.viewCount || 0;
        // Simulate country data (would come from real IP geolocation in backend)
        if (sub.viewCount > 0) {
          // Add some simulated countries
          const countries = ['BD', 'IN', 'PK', 'US', 'UK', 'CA', 'AU'];
          const randomCountry = countries[Math.floor(Math.random() * countries.length)];
          uniqueCountries.add(randomCountry);
        }
      });
      document.getElementById('totalClicks').textContent = totalClicks;
      document.getElementById('uniqueCountries').textContent = uniqueCountries.size;
      document.getElementById('totalSubmissions').textContent = userSubmissions.length;
      document.getElementById('approvedCount').textContent = userSubmissions.filter(s => s.status === 'approved').length;
    }
    // --- URL SUBMISSIONS - LIBRARY SHELF STYLE ---
    function displayUserSubmissions() {
      const currentUser = checkAuth();
      if (!currentUser) return;
      const allSubmissions = loadData('niroboAllSubmissions', []);
      const userSubmissions = allSubmissions.filter(sub => sub.userId === currentUser.id);

      // Group submissions by category
      const categories = {
        'websites': { title: 'Websites', icon: 'fas fa-window-maximize', submissions: [] },
        'images': { title: 'Images', icon: 'fas fa-image', submissions: [] },
        'videos': { title: 'Videos', icon: 'fas fa-video', submissions: [] },
        'documents': { title: 'Documents', icon: 'fas fa-file-alt', submissions: [] },
        'tools': { title: 'Tools', icon: 'fas fa-wrench', submissions: [] }
      };

      userSubmissions.forEach(sub => {
        const categoryKey = sub.category || 'websites'; // Default to websites
        if (categories[categoryKey]) {
          categories[categoryKey].submissions.push(sub);
        } else {
          // Handle unknown categories by grouping them under 'websites'
          categories['websites'].submissions.push(sub);
        }
      });

      submissionsLibrary.innerHTML = '';

      // Check if user has reached submission limit
      if (userSubmissions.length >= MAX_SUBMISSIONS_PER_USER) {
        const limitNotice = document.createElement('div');
        limitNotice.className = 'empty-state';
        limitNotice.innerHTML = `
          <h3>⚠️ Submission Limit Reached</h3>
          <p>You have submitted the maximum of ${MAX_SUBMISSIONS_PER_USER} URLs.</p>
          <p>Please contact support if you need to submit more.</p>
        `;
        submissionsLibrary.appendChild(limitNotice);
      }

      // Render shelves for each category
      Object.keys(categories).forEach(catKey => {
        const category = categories[catKey];
        if (category.submissions.length > 0) {
          const shelfDiv = document.createElement('div');
          shelfDiv.className = 'shelf';
          shelfDiv.innerHTML = `
            <div class="shelf-header">
              <div class="shelf-title">
                <i class="${category.icon}"></i> ${category.title}
              </div>
              <div class="shelf-count">${category.submissions.length} items</div>
            </div>
            <div class="shelf-books">
              ${category.submissions.map(sub => {
                const domain = getDomain(sub.url);
                const cleanUrl = sub.url.replace(/^https?:\/\//, '').replace(/\/$/, '');
                const truncatedUrl = cleanUrl.length > 30 ? cleanUrl.substring(0, 30) + '...' : cleanUrl;
                const statusClass = sub.status || 'pending';
                const statusText = sub.status ? sub.status.toUpperCase() : 'PENDING';
                
                // Determine icon based on category
                let iconClass = 'fas fa-link';
                switch(catKey) {
                  case 'websites': iconClass = 'fas fa-window-maximize'; break;
                  case 'images': iconClass = 'fas fa-image'; break;
                  case 'videos': iconClass = 'fas fa-video'; break;
                  case 'documents': iconClass = 'fas fa-file-alt'; break;
                  case 'tools': iconClass = 'fas fa-wrench'; break;
                }

                return `
                  <div class="book-card ${statusClass}">
                    <div class="book-cover">
                      <i class="${iconClass}"></i>
                    </div>
                    <div class="book-title">${sub.title}</div>
                    <a href="${sub.url}" class="book-url" target="_blank" rel="noopener">${truncatedUrl}</a>
                    <div class="book-status ${statusClass}">${statusText}</div>
                    <div class="book-meta">
                      <div class="book-submitted">
                        ${sub.submittedAt ? `Submitted: ${formatDate(sub.submittedAt)}` : 'Source: Database'}
                      </div>
                      <div class="book-views">
                        👀 ${sub.viewCount || 0}
                      </div>
                    </div>
                    ${sub.adminMessage ? `<div class="admin-message">💬 ${sub.adminMessage}</div>` : ''}
                    <div class="book-actions">
                      <button class="book-action-btn edit-btn" onclick="editSubmission('${sub.id}')">
                        <i class="fas fa-edit"></i> Edit
                      </button>
                      <button class="book-action-btn delete-btn" onclick="deleteSubmission('${sub.id}')">
                        <i class="fas fa-trash"></i> Delete
                      </button>
                    </div>
                  </div>
                `;
              }).join('')}
            </div>
          `;
          submissionsLibrary.appendChild(shelfDiv);
        }
      });

      // If no submissions at all
      if (userSubmissions.length === 0) {
        submissionsLibrary.innerHTML = '<div class="empty-state"><h3>📭 Your Library is Empty</h3><p>Submit your first URL to start building your collection!</p></div>';
      }
    }
    // Edit submission
    window.editSubmission = function(id) {
      const currentUser = checkAuth();
      if (!currentUser) return;
      const allSubmissions = loadData('niroboAllSubmissions', []);
      const submission = allSubmissions.find(sub => sub.userId === currentUser.id && sub.id === id);
      if (!submission) {
        showNotification('❌ Submission not found.', 'error');
        return;
      }
      // Redirect to signup.html with submission data (conceptual)
      // In a real app, you'd pass data via URL params or localStorage
      window.location.href = `signup.html?edit=${id}`;
    };
    // Delete submission
    window.deleteSubmission = function(id) {
      const currentUser = checkAuth();
      if (!currentUser) return;
      if (!confirm('Are you sure you want to remove this submission?')) return;
      let allSubmissions = loadData('niroboAllSubmissions', []);
      const index = allSubmissions.findIndex(sub => sub.userId === currentUser.id && sub.id === id);
      if (index !== -1) {
        allSubmissions.splice(index, 1);
        saveData('niroboAllSubmissions', allSubmissions);
        showNotification('🗑️ Submission removed.', 'info');
        displayUserSubmissions();
        displayAnalytics(); // Update analytics after deletion
      }
    };
    // --- ACCOUNT MANAGEMENT ---
    // Change Email
    changeEmailBtn.addEventListener('click', () => {
      const currentUser = checkAuth();
      if (!currentUser) return;
      const newEmailValue = newEmail.value.trim();
      if (!newEmailValue) {
        showNotification('Please enter a new email address.', 'error');
        return;
      }
      
      // Check if email is already taken
      const users = loadData('niroboUsers', []);
      const emailExists = users.some(u => u.email === newEmailValue && u.id !== currentUser.id);
      if (emailExists) {
        showNotification('❌ This email is already in use.', 'error');
        return;
      }
      
      // Update user email
      const userIndex = users.findIndex(u => u.id === currentUser.id);
      if (userIndex !== -1) {
        users[userIndex].email = newEmailValue;
        saveData('niroboUsers', users);
        
        // Update current user session
        currentUser.email = newEmailValue;
        saveData('niroboCurrentUser', currentUser);
        userEmail.textContent = newEmailValue;
        
        showNotification('✅ Email updated successfully!', 'success');
        newEmail.value = '';
      } else {
        showNotification('❌ User not found.', 'error');
      }
    });
    
    // Change Password
    changePasswordBtn.addEventListener('click', () => {
      const currentUser = checkAuth();
      if (!currentUser) return;
      const oldPw = oldPassword.value;
      const newPw = newPassword.value;
      const confirmPw = confirmNewPassword.value;
      
      if (!oldPw || !newPw || !confirmPw) {
        showNotification('Please fill in all password fields.', 'error');
        return;
      }
      
      if (newPw !== confirmPw) {
        showNotification('❌ New passwords do not match.', 'error');
        return;
      }
      
      // Verify old password
      const users = loadData('niroboUsers', []);
      const user = users.find(u => u.id === currentUser.id);
      if (!user || user.password !== hashPassword(oldPw)) {
        showNotification('❌ Incorrect old password.', 'error');
        return;
      }
      
      // Update password
      const userIndex = users.findIndex(u => u.id === currentUser.id);
      if (userIndex !== -1) {
        users[userIndex].password = hashPassword(newPw);
        saveData('niroboUsers', users);
        
        showNotification('✅ Password updated successfully!', 'success');
        oldPassword.value = '';
        newPassword.value = '';
        confirmNewPassword.value = '';
      } else {
        showNotification('❌ User not found.', 'error');
      }
    });
    
    // Delete Account
    deleteAccountBtn.addEventListener('click', () => {
      const currentUser = checkAuth();
      if (!currentUser) return;
      if (!confirm('⚠️ Are you absolutely sure you want to delete your account? This action is irreversible and all your data will be permanently lost.')) {
        return;
      }
      
      // Remove user from users list
      let users = loadData('niroboUsers', []);
      users = users.filter(u => u.id !== currentUser.id);
      saveData('niroboUsers', users);
      
      // Remove user's submissions
      let allSubmissions = loadData('niroboAllSubmissions', []);
      allSubmissions = allSubmissions.filter(sub => sub.userId !== currentUser.id);
      saveData('niroboAllSubmissions', allSubmissions);
      
      // Remove current user session
      localStorage.removeItem('niroboCurrentUser');
      
      showNotification('🗑️ Your account has been deleted.', 'info');
      
      // Redirect to signup page
      setTimeout(() => {
        window.location.href = 'signup.html';
      }, 2000);
    });
    // --- INITIALIZATION ---
    document.addEventListener("DOMContentLoaded", () => {
      const user = checkAuth();
      if (user) {
        displayAnalytics();
        displayUserSubmissions();
      }
    });
  </script>
</body>
</html>
