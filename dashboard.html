<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nirobo ‚Äî Your Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-dark: #004d00;
      --primary: #006400;
      --primary-light: #008000;
      --accent: #d40000;
      --accent-hover: #ff0000;
      --background: #0a1f0a;
      --card-bg: #1a1a1a;
      --text: #f5f5f5;
      --text-secondary: #cccccc;
      --border: #333333;
      --success: #00aa00;
      --warning: #ff9900;
      --danger: #d40000;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: linear-gradient(135deg, var(--background), var(--primary-dark));
      color: var(--text);
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      padding: 30px 0;
      border-bottom: 2px solid var(--accent);
      margin-bottom: 30px;
    }

    .header h1 {
      color: var(--accent);
      font-size: 2.5rem;
      margin-bottom: 10px;
    }

    .header h1 span {
      color: var(--text);
    }

    .header p {
      font-style: italic;
      color: #ffcccc;
    }

    a {
      color: var(--accent);
      text-decoration: underline;
    }

    .login-section {
      background: rgba(255, 255, 255, 0.1);
      padding: 30px;
      text-align: center;
      border-radius: 15px;
      margin-bottom: 30px;
    }

    .login-section input {
      margin: 5px;
      padding: 10px;
      width: 200px;
      border: 1px solid var(--accent);
      background: rgba(0, 0, 0, 0.2);
      border-radius: 4px;
      color: white;
      font-size: 16px;
    }

    .login-section button {
      margin: 5px;
      padding: 10px 20px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
    }

    .login-section button:hover {
      background: var(--accent-hover);
    }

    .user-info {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 10px;
      display: inline-block;
      margin-bottom: 30px;
      color: #ffcccc;
    }

    .section {
      background: rgba(0, 0, 0, 0.3);
      padding: 30px;
      border-radius: 15px;
      margin-bottom: 30px;
      border-left: 4px solid var(--accent);
    }

    .section h2 {
      color: #ffcccc;
      margin-bottom: 20px;
      font-size: 1.5rem;
      border-bottom: 1px solid var(--accent);
      padding-bottom: 10px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #ffcccc;
    }

    input, textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--accent);
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      color: white;
      font-size: 16px;
      box-sizing: border-box;
    }

    button.main-btn {
      padding: 12px 24px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      width: 100%;
      margin-top: 10px;
    }

    button.main-btn:hover {
      background: var(--accent-hover);
    }

    .submission-item {
      background: rgba(255, 255, 255, 0.05);
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      border-left: 4px solid var(--accent);
    }

    .submission-item.approved { border-left-color: var(--success); }
    .submission-item.rejected { border-left-color: var(--danger); }
    .submission-item.pending { border-left-color: var(--warning); }

    .submission-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 10px;
    }

    .submission-title {
      font-size: 1.2rem;
      font-weight: bold;
    }

    .status {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: bold;
    }

    .status.approved { background: rgba(0, 170, 0, 0.3); color: var(--success); }
    .status.rejected { background: rgba(212, 0, 0, 0.3); color: var(--danger); }
    .status.pending { background: rgba(255, 153, 0, 0.3); color: var(--warning); }

    .submission-url {
      color: #ff9999;
      text-decoration: none;
      margin-bottom: 10px;
      display: block;
    }

    .admin-message {
      background: rgba(0, 100, 200, 0.2);
      padding: 10px;
      border-radius: 6px;
      margin: 10px 0;
      font-style: italic;
      font-size: 0.9rem;
    }

    .actions {
      margin-top: 15px;
    }

    .btn-delete {
      background: var(--danger);
      padding: 8px 16px;
      font-size: 0.9rem;
      width: auto;
    }

    .logout-btn {
      background: var(--danger);
      padding: 10px 20px;
      font-size: 1rem;
      display: block;
      margin: 30px auto 0;
      text-align: center;
      width: auto;
    }

    footer {
      background: var(--card-bg);
      color: var(--text-secondary);
      padding: 20px;
      text-align: center;
      font-size: 0.9rem;
      border-top: 1px solid var(--border);
      margin-top: 40px;
      border-radius: 10px;
    }

    footer a {
      color: #ff9999;
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }

    .empty-state {
        text-align: center;
        padding: 50px 20px;
        color: var(--text-secondary);
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 500;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      z-index: 1000;
      transform: translateX(120%);
      transition: transform 0.3s ease;
      max-width: 300px;
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.success {
      background: linear-gradient(45deg, var(--success), #00cc00);
    }

    .notification.error {
      background: linear-gradient(45deg, var(--danger), #ff3333);
    }

    .notification.warning {
      background: linear-gradient(45deg, var(--warning), #ffcc00);
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>
        <span>N</span>
        <span>I</span>
        <span>R</span>
        <span>O</span>
        <span>B</span>
        <span>O</span>
      </h1>
      <p>‚ÄúYou hold the pen ‚Äî write your truth into Bangladesh‚Äôs digital soul.‚Äù</p>
    </div>

    <a href="/">‚Üê Back to Nirobo</a>

    <!-- Login Section (Hidden when logged in) -->
    <div id="loginSection" class="login-section">
      <h2>üîê Please Log In</h2>
      <p>Submit and manage your website in Nirobo's curated search engine</p>
      
      <div class="form-group">
        <input type="email" id="loginEmail" placeholder="Email" />
      </div>
      <div class="form-group">
        <input type="password" id="loginPassword" placeholder="Password" />
      </div>
      <button id="loginBtn">Login</button>
      
      <p style="margin-top: 20px; font-size: 0.9rem;">
        Don't have an account? <a href="signup.html">Sign Up</a> | 
        <a href="forgot-password.html">Forgot Password?</a>
      </p>
    </div>

    <!-- Dashboard Content (Hidden until login) -->
    <div id="dashboardContent" style="display: none;">
      
      <!-- User Info -->
      <div class="user-info">
        Logged in as: <strong id="userEmail">loading...</strong>
        <button id="logoutBtn" class="logout-btn">üö™ Logout</button>
        <!-- Optional link to Admin Panel if user is admin -->
        <div id="adminPanelLink" style="margin-top: 10px; display:none;">
            <a href="admin.html" style="color: #00aaff;">‚öôÔ∏è Go to Admin Panel</a>
        </div>
      </div>

      <!-- Submit New Website -->
      <div class="section">
        <h2>‚ûï SUBMIT A NEW WEBSITE</h2>
        <div class="form-group">
          <label>Website Title</label>
          <input type="text" id="websiteTitle" placeholder="e.g., My Blog" />
        </div>
        <div class="form-group">
          <label>URL</label>
          <input type="url" id="websiteUrl" placeholder="https://yourwebsite.com" />
        </div>
        <div class="form-group">
          <label>Description</label>
          <textarea id="websiteDesc" placeholder="Brief description of your website" rows="3"></textarea>
        </div>
        <div class="form-group">
          <label>Tags (comma separated)</label>
          <input type="text" id="websiteTags" placeholder="news, blog, bangla" />
        </div>
        <button id="submitWebsiteBtn" class="main-btn">Submit Website</button>
      </div>

      <!-- Your Submissions -->
      <div class="section">
        <h2>üìä YOUR SUBMISSIONS</h2>
        <div id="submissionsList">
          <p>Loading your submissions...</p>
        </div>
      </div>
    </div>

    <footer>
      Made in Bangladesh üáßüá© | Curated by Nirobo<br>
      Honoring the Language Movement and the Silent Legacy of Justice<br>
      Crafted by KH. AL SHAIF ‚Äî for truth, clarity, and cultural dignity<br>
      <a href="/">‚Üê Back to Nirobo</a>
    </footer>
  </div>

  <div class="notification" id="notification"></div>

  <script>
    // --- CONFIGURATION ---
    const MAX_SUBMISSIONS_PER_DOMAIN = 10;

    // --- DOM ELEMENTS ---
    const loginSection = document.getElementById('loginSection');
    const dashboardContent = document.getElementById('dashboardContent');
    const loginEmail = document.getElementById('loginEmail');
    const loginPassword = document.getElementById('loginPassword');
    const userEmail = document.getElementById('userEmail');
    const submissionsList = document.getElementById('submissionsList');
    const notification = document.getElementById('notification');
    const adminPanelLink = document.getElementById('adminPanelLink');

    // --- HELPER FUNCTIONS ---

    // Show notification
    function showNotification(message, type = 'info') {
        notification.textContent = message;
        notification.className = 'notification ' + type;
        notification.classList.add('show');

        setTimeout(() => {
            notification.classList.remove('show');
        }, 3000);
    }

    // Load data from localStorage
    function loadData(key, defaultValue = []) {
      try {
        return JSON.parse(localStorage.getItem(key) || JSON.stringify(defaultValue));
      } catch (e) {
        console.error(`Error loading ${key}:`, e);
        return defaultValue;
      }
    }

    // Save data to localStorage
    function saveData(key, data) {
      try {
        localStorage.setItem(key, JSON.stringify(data));
      } catch (e) {
        console.error(`Error saving ${key}:`, e);
        showNotification('Failed to save data. Storage might be full.', 'error');
      }
    }

    // Hash password (simple for demo)
    function hashPassword(password) {
      return btoa(password); // Not secure, but works for demo
    }

    // Format date
    function formatDate(isoString) {
        if (!isoString) return 'Unknown';
        const date = new Date(isoString);
        // Ensure it's displayed in local (BD) time
        return date.toLocaleString('en-GB', {
            timeZone: 'Asia/Dhaka',
            day: '2-digit',
            month: 'short',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            hour12: true
        });
    }

    // Get domain from URL
    function getDomain(url) {
      try {
        return new URL(url).hostname.replace('www.', '');
      } catch (e) {
        return 'unknown-domain';
      }
    }

    // --- AUTHENTICATION ---

    // Check if user is logged in and handle redirects
    function checkAuth() {
      const currentUser = loadData('niroboCurrentUser', null);
      
      if (!currentUser) {
         // Not logged in, show login form
         loginSection.style.display = 'block';
         dashboardContent.style.display = 'none';
         return null;
      }
      
      // Check if user is banned
      const punishments = loadData('niroboPunishments', {});
      const userPunishment = punishments[currentUser.id];

      if (userPunishment) {
          if (userPunishment.banStatus === "perm_ban") {
              showNotification('‚ùå Your account has been permanently banned.', 'error');
              localStorage.removeItem('niroboCurrentUser'); // Log out
              setTimeout(() => window.location.href = 'signup.html', 2000);
              return null;
          }

          if (userPunishment.banStatus === "temp_ban" && userPunishment.banUntil) {
              const banUntil = new Date(userPunishment.banUntil);
              if (new Date() < banUntil) {
                  showNotification(`‚ùå Your account is temporarily banned until ${formatDate(userPunishment.banUntil)}.`, 'error');
                   localStorage.removeItem('niroboCurrentUser'); // Log out
                   setTimeout(() => window.location.href = 'signup.html', 2000);
                  return null;
              } else {
                  // Ban expired - remove it
                  delete punishments[currentUser.id];
                  saveData('niroboPunishments', punishments);
                  showNotification('Your temporary ban has expired.', 'warning');
              }
          }
      }
      
      // User is logged in and not banned
      loginSection.style.display = 'none';
      dashboardContent.style.display = 'block';
      userEmail.textContent = currentUser.email;
      
      // Check if user is admin (for example, first user or specific email)
      const allUsers = loadData('niroboUsers', []);
      const isAdmin = allUsers.length > 0 && allUsers[0].id === currentUser.id;
      // OR: const isAdmin = currentUser.email === "admin@nirobo.net";
      if (isAdmin) {
          adminPanelLink.style.display = 'block';
      } else {
          adminPanelLink.style.display = 'none';
      }
      
      return currentUser;
    }

    // Login button handler
    document.getElementById('loginBtn').addEventListener('click', () => {
      const email = loginEmail.value.trim();
      const password = loginPassword.value;

      if (!email || !password) {
        showNotification('Please enter email and password', 'error');
        return;
      }

      const users = loadData('niroboUsers', []);
      const user = users.find(u => u.email === email && u.password === hashPassword(password));

      if (!user) {
        showNotification('‚ùå Invalid email or password', 'error');
        return;
      }

      // Check ban status again on login
      const punishments = loadData('niroboPunishments', {});
      const userPunishment = punishments[user.id];

      if (userPunishment) {
          if (userPunishment.banStatus === "perm_ban") {
              showNotification('‚ùå Your account has been permanently banned.', 'error');
              return;
          }

          if (userPunishment.banStatus === "temp_ban" && userPunishment.banUntil) {
              const banUntil = new Date(userPunishment.banUntil);
              if (new Date() < banUntil) {
                  showNotification(`‚ùå Your account is temporarily banned until ${formatDate(userPunishment.banUntil)}.`, 'error');
                  return;
              } else {
                  // Ban expired - remove it
                  delete punishments[user.id];
                  saveData('niroboPunishments', punishments);
                  showNotification('Your temporary ban has expired.', 'warning');
              }
          }
      }

      // Save current user
      saveData('niroboCurrentUser', user);
      
      // Redirect to avoid reload issues and ensure clean state
      window.location.href = 'dashboard.html';
    });

    // Logout button handler
    document.getElementById('logoutBtn').addEventListener('click', () => {
      localStorage.removeItem('niroboCurrentUser');
      showNotification('‚úÖ Logged out successfully.', 'success');
      
      // Redirect to login/signup
      setTimeout(() => {
         window.location.href = 'signup.html';
      }, 1000);
    });

    // --- SUBMISSION SYSTEM ---

    // Submit new website
    document.getElementById('submitWebsiteBtn').addEventListener('click', () => {
      const title = document.getElementById('websiteTitle').value.trim();
      const url = document.getElementById('websiteUrl').value.trim();
      const desc = document.getElementById('websiteDesc').value.trim();
      const tagsInput = document.getElementById('websiteTags').value;

      if (!title || !url) {
        showNotification('Please enter title and URL', 'error');
        return;
      }

      const currentUser = loadData('niroboCurrentUser', null);
      if (!currentUser) {
        showNotification('Please log in first', 'error');
        // Redirect to login
        setTimeout(() => {
            window.location.href = 'signup.html';
        }, 1500);
        return;
      }

      // Check ban status again (paranoid check)
      const punishments = loadData('niroboPunishments', {});
      const userPunishment = punishments[currentUser.id];
      if (userPunishment) {
          if (userPunishment.banStatus === "perm_ban" || 
             (userPunishment.banStatus === "temp_ban" && new Date(userPunishment.banUntil) > new Date())) {
              showNotification('‚ùå You cannot submit websites. Your account is banned.', 'error');
              return;
          }
      }

      // Check domain limit
      try {
        const domain = getDomain(url);
        const allSubmissions = loadData('niroboAllSubmissions', []);
        const domainSubmissions = allSubmissions.filter(item =>
          getDomain(item.url) === domain && item.userId === currentUser.id
        );

        if (domainSubmissions.length >= MAX_SUBMISSIONS_PER_DOMAIN) {
          showNotification(`‚ùå You've reached the limit of ${MAX_SUBMISSIONS_PER_DOMAIN} submissions for ${domain}.`, 'error');
          return;
        }

        // Process tags
        const tags = tagsInput.split(',')
          .map(tag => tag.trim())
          .filter(tag => tag.length > 0)
          .slice(0, 10); // Limit to 10 tags

        if (tags.length === 0) {
          tags.push('general');
        }

        const newSubmission = {
          id: 'sub_' + Date.now() + '_' + Math.random().toString(36).substr(2, 5),
          userId: currentUser.id,
          title,
          url,
          description: desc,
          tags: tags,
          submittedAt: new Date().toISOString(),
          status: "pending",
          viewCount: 0,
          adminMessage: "",
          submitterEmail: currentUser.email // Store for admin reference
        };

        allSubmissions.push(newSubmission);
        saveData('niroboAllSubmissions', allSubmissions);

        showNotification('‚úÖ Website submitted for review!', 'success');

        // Clear form
        document.getElementById('websiteTitle').value = '';
        document.getElementById('websiteUrl').value = '';
        document.getElementById('websiteDesc').value = '';
        document.getElementById('websiteTags').value = '';

        // Refresh submissions list
        displayUserSubmissions();

      } catch (e) {
        showNotification('‚ùå Please enter a valid URL (e.g., https://example.com)', 'error');
      }
    });

    // Display user's submissions
    function displayUserSubmissions() {
      const allSubmissions = loadData('niroboAllSubmissions', []);
      const currentUser = loadData('niroboCurrentUser', null);

      if (!currentUser) return;

      const userSubmissions = allSubmissions.filter(sub => sub.userId === currentUser.id);

      if (userSubmissions.length === 0) {
        submissionsList.innerHTML = '<div class="empty-state"><h3>üì≠ No submissions yet</h3><p>Submit your first website above to get started!</p></div>';
        return;
      }

      submissionsList.innerHTML = '';
      userSubmissions.forEach(sub => {
        const domain = getDomain(sub.url);
        const div = document.createElement('div');
        div.className = `submission-item ${sub.status}`;
        div.innerHTML = `
          <div class="submission-header">
            <div class="submission-title">${sub.title}</div>
            <span class="status ${sub.status}">${sub.status.toUpperCase()}</span>
          </div>
          <a href="${sub.url}" target="_blank" class="submission-url">${domain}</a>
          <p>${sub.description || 'No description provided.'}</p>
          <p><small>Tags: ${Array.isArray(sub.tags) ? sub.tags.join(', ') : 'general'}</small></p>
          <p><small>Submitted: ${formatDate(sub.submittedAt)}</small></p>
          <p><small>üëÄ Views: ${sub.viewCount || 0}</small></p>
          ${sub.adminMessage ? `<div class="admin-message">üí¨ Admin Message: ${sub.adminMessage}</div>` : ''}
          <div class="actions">
            <button class="btn-delete" onclick="deleteSubmission('${sub.id}')">üóëÔ∏è Remove Submission</button>
          </div>
        `;
        submissionsList.appendChild(div);
      });
    }

    // Delete submission
    window.deleteSubmission = function(submissionId) {
      if (!confirm('Are you sure you want to remove this submission?')) {
        return;
      }

      let allSubmissions = loadData('niroboAllSubmissions', []);
      const index = allSubmissions.findIndex(sub => sub.id === submissionId);

      if (index !== -1) {
        allSubmissions.splice(index, 1);
        saveData('niroboAllSubmissions', allSubmissions);

        showNotification('üóëÔ∏è Submission removed.', 'success');
        displayUserSubmissions();
      }
    };

    // --- INITIALIZATION ---

    // Check if user is already logged in on page load
    document.addEventListener('DOMContentLoaded', () => {
      const user = checkAuth(); // This also sets up the UI
      if (user) {
        displayUserSubmissions();
      }
    });
  </script>
</body>
</html>
